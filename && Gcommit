-- vim: ft=lua:
-- True is locking the location
redstone.setOutput("right",true)
local sensor,authfile,sesameBol
local authorisedUsers = {}
for key, name in pairs(peripheral.getNames()) do
    if (peripheral.getType(name) == "openperipheral_sensor") then 
        sensor = peripheral.wrap(name)
    end
end
assert(sensor)

authfile = assert(fs.open("auth","r"))
while (table.insert(authorisedUsers, authfile.readLine())) do end
authfile.close()

while true do
    sesameBol = false
    for key, name in pairs(sensor.getPlayerNames()) do
        for i=0,#authorisedUsers do
            if name == authorisedUsers[i] then
                sesameBol = true
            end

        end
    end

    if sesameBol then
        print("Authorised user detected")
        redstone.setOutput("left",false)
        os.sleep(10)
        redstone.setOutput("",true)
    end
    os.sleep(1)
end
